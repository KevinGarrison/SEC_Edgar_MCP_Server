{% extends "base.html" %}
{% block title %}API Keys{% endblock %}
{% block content %}
<h1 class="text-xl font-bold mb-4">API Keys</h1>

{% if flash_api_key %}
<div class="mb-4 p-4 border rounded bg-yellow-50">
  <h2 class="font-semibold mb-2">Your new API key</h2>
  <p class="text-sm text-gray-700 mb-2">Copy this now and paste it into OpenAI → Add connector → Access token / API key. You won't see it again.</p>
  <div class="flex items-center gap-2">
    <pre id="new-key" class="p-2 bg-white border rounded overflow-x-auto">{{ flash_api_key }}</pre>
    <button type="button" onclick="navigator.clipboard.writeText(document.getElementById('new-key').innerText)" class="px-3 py-2 text-sm bg-blue-600 text-white rounded">Copy</button>
  </div>
</div>
{% endif %}

<form action="/keys/create" method="post" class="mb-4">
  <input type="text" name="label" placeholder="Service (label)" class="border rounded px-2 py-1 mr-2" required>
  <button class="px-3 py-2 bg-green-600 text-white rounded">Create new key</button>
</form>

<table class="min-w-full border border-gray-200">
  <thead class="bg-gray-100">
    <tr>
      <th class="px-4 py-2 text-left">Service</th>
      <th class="px-4 py-2 text-left">Created</th>
      <th class="px-4 py-2 text-left">Expires</th>
      <th class="px-4 py-2 text-left">Status</th>
      <th class="px-4 py-2"></th>
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
    <tr class="border-t">
      <td class="px-4 py-2">{{ row.service }}</td>
      <td class="px-4 py-2">{{ row.created_at }}</td>
      <td class="px-4 py-2">{{ row.expires_at }}</td>
      <td class="px-4 py-2">
        {% if row.revoked %}
          <span class="text-red-600">Revoked</span>
        {% else %}
          <span class="text-green-600">Active</span>
        {% endif %}
      </td>
      <td class="px-4 py-2">
        {% if not row.revoked %}
        <form action="/keys/revoke" method="post">
          <input type="hidden" name="hash" value="{{ row.hash }}">
          <button class="px-2 py-1 text-sm bg-red-600 text-white rounded">Revoke</button>
        </form>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}